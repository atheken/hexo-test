<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Node.js App Basics - Part 4 · AndrewTheken.com</title><meta name="description" content="Node.js App Basics - Part 4 - Andrew Theken"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://andrewtheken.com/atom.xml" title="AndrewTheken.com"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node.js App Basics - Part 4</h1><div class="post-info">Dec 31, 2014</div><div class="post-content"><hr>
<p>Feel free to review the other posts in this series:</p>
<ul>
<li><a href="/2013/09/01/Essential-Tools-for-node.js/">Part 0</a></li>
<li><a href="/2013/09/02/Node.js-App-Basics-Part-1/">Part 1</a> </li>
<li><a href="/2013/09/03/Node.js-App-Basics-Part-2/">Part 2</a></li>
<li><a href="/2013/09/20/Node.js-App-Basics-Part-3/">Part 3</a> </li>
<li>Part 4 (You’re already here!)</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title="== "></a>== </h2><p>Alright, let’s finish this basic application up.</p>
<p>We’ve been using “connect” as the basis for our middleware so far. In many cases, you’ll want to be able to set up handling for specific routes using specific REST verbs, as well as read request parameters and easily pipe non-html data to the client. “express” is a package that extends “connect”, and is essentially the “gold-standard” from which to build HTTP applications in Node.js</p>
<p>Install express now:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install express --save</div></pre></td></tr></table></figure>
<p>We will use express in place of connect for the remainder of this tutorial.</p>
<p>As I have mentioned before, <a href="http://npmjs.org" target="_blank" rel="external">npm</a> has a huge number of packages, and finding something that works the way you want can be a little bit daunting.</p>
<p>We’re working on a simple UI that can take a query from the user, and locate entries from Wikipedia that make sense.</p>
<p>I have located a package that can take care of the actual query to wikipedia ‘wikijs’, so let’s install that in our project now.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install wikijs --save</div></pre></td></tr></table></figure>
<p>Next, we want to provide a basic GET endpoint to our connect server that accepts a query, and returns some JSON answers. Update your “server.js” file as folllows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">//We&apos;re switching to &quot;express&quot;, instead of &quot;connect&quot;, </div><div class="line">//because it _extends connect_ with some useful middleware/http </div><div class="line">//request handling.</div><div class="line">var express = require(&apos;express&apos;);</div><div class="line"></div><div class="line">var Wiki = require(&quot;wikijs&quot;);</div><div class="line"></div><div class="line">//we&apos;re still using Node&apos;s built in HTTP server, so let&apos;s pull it in.</div><div class="line">var http = require(&apos;http&apos;);</div><div class="line"></div><div class="line">//create our middleware stack (just send a basic message for now):</div><div class="line">var app = express()</div><div class="line">	//add logging to all requests</div><div class="line">	.use(express.logger())</div><div class="line">	 //serve &quot;static files from the public directory&quot;</div><div class="line">	 .use(express.static(__dirname + &apos;/public&apos;))</div><div class="line">	 </div><div class="line">	 // adding a new search to wikipedia, limiting to 25 entries, for now.</div><div class="line">	 // notice that we are now using &quot;.get&quot; instead of &quot;.use&quot;, Express</div><div class="line">	 // adds .get()/.post()/.put()/.delete()/.all() methods to allow the creation of </div><div class="line">	 // RESTful HTTP endpoints</div><div class="line">	 .get(&apos;/search&apos;, function(req, res, next)&#123;</div><div class="line"></div><div class="line">	 	//Express also makes it easy to read GET/POST params from the </div><div class="line">	 	//request using .param()</div><div class="line">	 	var query = req.param(&apos;q&apos;);</div><div class="line">	 	Wiki.search(query, 25, function(err, results)&#123;</div><div class="line">	 		if(err)&#123;</div><div class="line">	 			next(err);</div><div class="line">	 		&#125;else&#123;</div><div class="line">	 			//Express also allows us to write non-html responses</div><div class="line">	 			//easily, like JSON.</div><div class="line">	 			res.json(results);</div><div class="line">	 		&#125;</div><div class="line">	 	&#125;)</div><div class="line">	 &#125;)</div><div class="line">	//do the original request handling added in part 1.</div><div class="line">	.use(function(request, response)&#123;</div><div class="line">		response.write(&apos;Hello from connect!&apos;);</div><div class="line">		response.end();</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">//start a server on port 3000, any request that comes in should call</div><div class="line">//the &quot;app&quot; function that is our middleware stack from above.</div><div class="line">http.createServer(app).listen(3000);</div></pre></td></tr></table></figure>
<p>Go ahead and fire up “supervisor server.js” and navigate to <a href="http://localhost:3000/search?q=node" target="_blank" rel="external">http://localhost:3000/search?q=node</a></p>
<p>If everything is working, this should produce an array of json results, now all we have to do is wire up the interface to take advantage of this new method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">	&lt;style&gt;</div><div class="line">*&#123;</div><div class="line">	font-family: arial;</div><div class="line">	padding: 0px;</div><div class="line">	margin: 0px;</div><div class="line">&#125;</div><div class="line">html&#123;</div><div class="line">	width: 100%;</div><div class="line">	background: #cfcfcf;</div><div class="line">&#125;</div><div class="line">body&#123;</div><div class="line">	text-align: center;</div><div class="line">	width: 80%;</div><div class="line">	margin: 20px auto;</div><div class="line">	padding: 10px;</div><div class="line">	background: white;</div><div class="line">	border-radius: 5px;</div><div class="line">	box-shadow: 0px 0px 5px 0px;</div><div class="line">&#125;</div><div class="line">input&#123;</div><div class="line">	width:50%;</div><div class="line">	font-size: 20px;</div><div class="line">	padding: 5px;</div><div class="line">&#125;</div><div class="line">#results&#123;</div><div class="line">	min-height: 200px;</div><div class="line">	padding: 10px;</div><div class="line">&#125;</div><div class="line">	&lt;/style&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;input type=&quot;text&quot; id=&quot;query&quot; placeholder=&quot;Search Wikipedia&quot;&gt;</div><div class="line">	&lt;div id=&quot;results&quot;&gt;You can query wikipedia by typing a search above.&lt;/div&gt;</div><div class="line">	&lt;script src=&quot;//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">	&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js&quot;&gt;&lt;/script&gt;</div><div class="line">	&lt;script&gt;</div><div class="line">		$(function()&#123;</div><div class="line">			// this is a pretty sloppy way of doing the this, but it&apos;s done here for </div><div class="line">			// demo purposes. Client-side scripting is a topic for another blog. :-)</div><div class="line">			var results = $(&apos;#results&apos;);</div><div class="line">			$(&apos;#query&apos;).keyup(_.debounce(function()&#123;</div><div class="line"></div><div class="line">				var query = $(this).val();</div><div class="line">				if(query !== &apos;&apos;)&#123;</div><div class="line">					results.empty().append(&apos;&lt;i&gt;Searching...&lt;/i&gt;&apos;);</div><div class="line">					$.get(&apos;/search&apos;,&#123;q : query&#125;).success(function(data)&#123;</div><div class="line">						results.empty();</div><div class="line">						_.each(data, function(element)&#123;</div><div class="line">							results.append(&apos;&lt;a target=&quot;_blank&quot; href=&quot;http://en.Wikipedia.org/wiki/&apos; + element + &apos;&quot;&gt;&apos; + element + &apos;&lt;/a&gt;&lt;br/&gt;&apos;);</div><div class="line">						&#125;);</div><div class="line">					&#125;).error(function()&#123;</div><div class="line">						results.empty().append(&apos;Oops, something bad happened, we couldn\&apos;t get any Wikipedia results&apos; );</div><div class="line">					&#125;);</div><div class="line">				&#125;</div><div class="line">				else&#123;</div><div class="line">					results.empty().append(&apos;You can search wikipedia by typing a query above.&apos;);</div><div class="line">				&#125;</div><div class="line">			&#125;, 250))</div><div class="line">		&#125;)</div><div class="line">	&lt;/script&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>Now, navigate to <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a>, if everything went well, you should now be able to type a query and get links to wikipedia articles.</p>
<p>Obviously, this is a pretty silly, because wikipedia actually provides this functionality, but it hopefully shows how to create a basic node web-application, from end to end.</p>
<p>In future posts, I’ll go into some of the other aspects of building production-ready node.js applications, and some other “gotchas” that I’ve been learning about along the way.</p>
</div></article></div></section><footer><div class="paginator"><a href="/2014/12/31/2013-09-20-Node.js-App-Basics-Part-3/" class="prev">PREV</a><a href="/2014/12/31/2014-10-06-observations-on-swift/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://andrewtheken.com">Andrew Theken</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>